{
  "dir_path": "/app/advertools",
  "package_name": "advertools",
  "sample_name": "advertools-test_header_spider",
  "src_dir": "advertools/",
  "test_dir": "tests/",
  "test_file": "tests/test_header_spider.py",
  "test_code": "import platform\n\nimport pytest\n\nfrom advertools.header_spider import crawl_headers\n\n\ndef test_crawl_headers_raises_on_wrong_file_extension():\n    with pytest.raises(ValueError):\n        crawl_headers(\"https://example.com\", \"myfile.wrong\")\n\n\n@pytest.mark.parametrize(\"column\", [\"url\", \"crawl_time\", \"status\"])\n@pytest.mark.skipif(platform.system() == \"Windows\", reason=\"Skip if on Windows\")\ndef test_crawl_headers_returns_df(headers_crawl_df, column):\n    assert column in headers_crawl_df\n",
  "GT_file_code": {
    "advertools/header_spider.py": "\"\"\"\n.. _crawl_headers:\n\n\ud83d\udd77 Python Status Code Checker with Response Headers\n===================================================\n\nA mini crawler that only makes ``HEAD`` requests to a known list of URLs. It\nuses `Scrapy <https://docs.scrapy.org/en/latest>`_ under the hood, which means\nyou get all its power in a simplified interface for a simple and specific\nuse-case.\n\nThe :func:`crawl_headers` function can be used to make those requests for\nvarious quality assurance and analysis reasons. Since ``HEAD`` requests don't\ndownload the whole page, this makes the crawling super light on servers, and\nmakes the process very fast.\n\nThe function is straight-forward and easy to use, you basically need a list of\nURLs and a file path where you want to save the output (in `.jl` format):\n\n.. thebe-button::\n    Run this code\n\n\n.. code-block::\n    :class: thebe, thebe-init\n\n    import advertools as adv\n    import pandas as pd\n\n    url_list = ['https://advertools.readthedocs.io', 'https://adver.tools',\n                'https://www.dashboardom.com', 'https://povertydata.org']\n    adv.crawl_headers(url_list, 'output_file.jl')\n    headers_df = pd.read_json('output_file.jl', lines=True)\n\n    headers_df\n\n\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n  ..  url                                           crawl_time             status    download_timeout  download_slot                download_latency    depth  protocol      body    resp_headers_content-length  resp_headers_server    resp_headers_date              resp_headers_content-type    resp_headers_content-encoding    request_headers_accept                                           request_headers_accept-language    request_headers_user-agent    request_headers_accept-encoding    resp_headers_vary      redirect_times    redirect_ttl  redirect_urls                        redirect_reasons  resp_headers_x-amz-id-2                                                       resp_headers_x-amz-request-id    resp_headers_last-modified     resp_headers_etag                     resp_headers_x-served    resp_headers_x-backend    resp_headers_x-rtd-project    resp_headers_x-rtd-version    resp_headers_x-rtd-path                     resp_headers_x-rtd-domain    resp_headers_x-rtd-version-method    resp_headers_x-rtd-project-method    resp_headers_referrer-policy    resp_headers_permissions-policy    resp_headers_strict-transport-security        resp_headers_cf-cache-status      resp_headers_age  resp_headers_expires           resp_headers_cache-control    resp_headers_expect-ct                                                                   resp_headers_cf-ray    resp_headers_alt-svc                         resp_headers_via\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n   0  https://adver.tools                           2022-02-11 02:32:26       200                 180  adver.tools                         0.0270483        0  HTTP/1.1       nan                              0  nginx/1.18.0 (Ubuntu)  Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      nan                               nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          nan\n   1  https://povertydata.org                       2022-02-11 02:32:26       200                 180  povertydata.org                     0.06442          0  HTTP/1.1       nan                          13270  nginx/1.18.0 (Ubuntu)  Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      Accept-Encoding                   nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          nan\n   2  https://advertools.readthedocs.io/en/master/  2022-02-11 02:32:26       200                 180  advertools.readthedocs.io           0.0271282        0  HTTP/1.1       nan                              0  cloudflare             Fri, 11 Feb 2022 02:32:26 GMT  text/html                    gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      Accept-Encoding                     1              19  https://advertools.readthedocs.io                 302  rNKT7MYjJ7hcnSvbnZg9qdqizeFfTx9YtZ3/gwNLj8M99yumuCgdd6YTm/iBMO9hrZTAi/iYl50=  EE0DJX6Z511TGX88                 Thu, 10 Feb 2022 17:04:27 GMT  W/\"14c904a172315a4922f4d28948b916c2\"  Nginx-Proxito-Sendfile   web-i-0710e93d610dd8c3e   advertools                    master                        /proxito/html/advertools/master/index.html  advertools.readthedocs.io    path                                 subdomain                            no-referrer-when-downgrade      interest-cohort=()                 max-age=31536000; includeSubDomains; preload  HIT                                           1083  Fri, 11 Feb 2022 04:32:26 GMT  public, max-age=7200          max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"  6dba2aae6b424107-PRG   h3=\":443\"; ma=86400, h3-29=\":443\"; ma=86400  nan\n   3  https://www.dashboardom.com                   2022-02-11 02:32:26       200                 180  www.dashboardom.com                 0.118614         0  HTTP/1.1       nan                          26837  gunicorn/19.9.0        Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     nan                              text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      nan                               nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          1.1 vegur\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n\n\n\nOptionally, you can customize the crawling behavior with the optional\n``custom_settings`` parameter. Please check the\n`crawl strategies <_crawl_strategies>`_ page for tips on how you can do that.\n\nHere are some of the common reasons for using a ``HEAD`` crawler:\n\n* **Checking status codes:** One of the most important maintenance tasks you\n  should be doing continuously. It's very easy to set up an automated script\n  the checks status codes for a few hundred or thousand URLs on a periodic\n  basis. You can easily build some rules and alerts based on the status codes\n  you get.\n* **Status codes of page elements:** Yes, your page returns a 200 OK status,\n  but what about all the elements/components of the page? Images, links\n  (internal and external), hreflang, canonical, URLs in metatags, script URLs,\n  URLs in various structured data elements like Twitter, OpenGraph, and\n  JSON-LD are some of the most important ones to check as well.\n* **Getting search engine directives:** Those directives can be set using meta\n  tags as well as response headers. This crawler gets all available response\n  headers so you can check for search engine-specific ones, like `noindex` for\n  example.\n* **Getting image sizes:** You might want to crawl a list of image URLs and get\n  their meta data. The response header `Content-Length` contains the length of\n  the page in bytes. With images, it contains the size of the image. This can\n  be an extremely efficient way of analyzing image sizes (and other meta data)\n  without having to download those images, which could consume a lot of\n  bandwidth. Lookout for the column ``resp_headers_content-length``.\n* **Getting image types:** The ``resp_headers_content-type`` gives you an\n  indication on the type of content of the page (or image when crawling image\n  URLs); `text/html`, `image/jpeg` and `image/png` are some such content types.\n\n\n\"\"\"  # noqa: E501\n\nimport datetime\nimport json\nimport subprocess\n\nfrom scrapy import Request, Spider\nfrom scrapy.exceptions import IgnoreRequest\n\n\nimport advertools as adv\nfrom advertools import __version__ as adv_version\nfrom advertools.spider import MAX_CMD_LENGTH, _split_long_urllist\n\nheader_spider_path = adv.__path__[0] + \"/header_spider.py\"\n\nuser_agent = f\"advertools/{adv_version}\"\n\n\nclass HeadersSpider(Spider):\n    name = \"headers_spider\"\n    custom_settings = {\n        \"USER_AGENT\": user_agent,\n        \"ROBOTSTXT_OBEY\": True,\n        \"HTTPERROR_ALLOW_ALL\": True,\n        \"AUTOTHROTTLE_ENABLED\": True,\n        \"AUTOTHROTTLE_TARGET_CONCURRENCY\": 8,\n    }\n\n    def __init__(self, url_list=None, *args, **kwargs):\n        super().__init__(*args, **kwargs)\n        self.start_urls = json.loads(json.dumps(url_list.split(\",\")))\n\n    def start_requests(self):\n        for url in self.start_urls:\n            try:\n                yield Request(\n                    url, callback=self.parse, errback=self.errback, method=\"HEAD\"\n                )\n            except Exception as e:\n                self.logger.error(repr(e))\n\n    def errback(self, failure):\n        if not failure.check(IgnoreRequest):\n            self.logger.error(repr(failure))\n            now = datetime.datetime.utcnow().strftime(\"%Y-%m-%d %H:%M:%S\")\n            yield {\n                \"url\": failure.request.url,\n                \"crawl_time\": now,\n                \"errors\": repr(failure),\n            }\n\n    def parse(self, response):\n        now = datetime.datetime.utcnow().strftime(\"%Y-%m-%d %H:%M:%S\")\n        yield {\n            \"url\": response.url,\n            \"crawl_time\": now,\n            \"status\": response.status,\n            **{\n                k: \"@@\".join(str(val) for val in v) if isinstance(v, list) else v\n                for k, v in response.meta.items()\n            },\n            \"protocol\": response.protocol,\n            \"body\": response.text or None,\n            **{\n                \"resp_headers_\" + k: v\n                for k, v in response.headers.to_unicode_dict().items()\n            },\n            **{\n                \"request_headers_\" + k: v\n                for k, v in response.request.headers.to_unicode_dict().items()\n            },\n        }\n\n\ndef crawl_headers(url_list, output_file, custom_settings=None):\n    \"\"\"Crawl a list of URLs using the HEAD method.\n\n    This function helps in analyzing a set of URLs by getting status codes,\n    download latency, all response headers and a few other meta data about the\n    crawled URLs.\n\n    Sine the full page is not downloaded, these requests are very light on\n    servers and it is super-fast. You can modify the speed of course through\n    various settings.\n\n    Typically status code checking is an on-going task that needs to be done\n    and managed. Automated alerts can be easily created based on certain status\n    codes. Another interesting piece of the information is the `Content-Length`\n    response header. This gives you the size of the response body without\n    having to download the whole page. It can also be very interesting with\n    image URLs. Downloading all images can really be expensive and time\n    consuming. Being able to get image sizes without having to download them\n    can help a lot in making decisions about optimizing those images.\n    Several other data can be interesting to analyze, depending on what\n    response headers you get.\n\n    Parameters\n    ----------\n    url_list : str, list\n      One or more URLs to crawl.\n    output_file : str\n      The path to the output of the crawl. Jsonlines only is supported to allow for\n      dynamic values. Make sure your file ends with \".jl\", e.g. `output_file.jl`.\n    custom_settings : dict\n      A dictionary of optional custom settings that you might want to add to the\n      spider's functionality. There are over 170 settings for all kinds of options. For\n      details please refer to the `spider settings <https://docs.scrapy.org/en/latest/topics/settings.html>`_\n      documentation.\n\n    Examples\n    --------\n\n    >>> import advertools as adv\n    >>> url_list = ['https://exmaple.com/A', 'https://exmaple.com/B',\n    ...             'https://exmaple.com/C', 'https://exmaple.com/D',\n    ...             'https://exmaple.com/E']\n\n    >>> adv.crawl_headers(url_list, 'output_file.jl')\n    >>> import pandas as pd\n    >>> crawl_df = pd.read_json('output_file.jl', lines=True)\n    \"\"\"\n    if isinstance(url_list, str):\n        url_list = [url_list]\n    if output_file.rsplit(\".\")[-1] != \"jl\":\n        raise ValueError(\n            \"Please make sure your output_file ends with '.jl'.\\n\"\n            \"For example:\\n\"\n            f\"{output_file.rsplit('.', maxsplit=1)[0]}.jl\"\n        )\n    settings_list = []\n    if custom_settings is not None:\n        for key, val in custom_settings.items():\n            if isinstance(val, dict):\n                setting = \"=\".join([key, json.dumps(val)])\n            else:\n                setting = \"=\".join([key, str(val)])\n            settings_list.extend([\"-s\", setting])\n\n    command = [\n        \"scrapy\",\n        \"runspider\",\n        header_spider_path,\n        \"-a\",\n        \"url_list=\" + \",\".join(url_list),\n        \"-o\",\n        output_file,\n    ] + settings_list\n    if len(\",\".join(url_list)) > MAX_CMD_LENGTH:\n        split_urls = _split_long_urllist(url_list)\n        for u_list in split_urls:\n            command[4] = \"url_list=\" + \",\".join(u_list)\n            subprocess.run(command)\n    else:\n        subprocess.run(command)\n"
  },
  "GT_src_dict": {
    "advertools/header_spider.py": {
      "crawl_headers": {
        "code": "def crawl_headers(url_list, output_file, custom_settings=None):\n    \"\"\"Crawl a list of URLs using the HEAD method to gather HTTP response headers and status codes efficiently.\n\nThis function performs lightweight HTTP HEAD requests to each URL provided in `url_list`, retrieving various metadata and reponse details without downloading full page content. It saves the results into a specified output file in JSON Lines format, which allows for easy dynamic data handling.\n\nParameters\n----------\nurl_list : str, list\n    One or more URLs to crawl, which can be provided as a single string or a list of strings.\noutput_file : str\n    The path to the file where the crawl results will be saved. This must end with '.jl' to follow the JSON Lines format.\ncustom_settings : dict, optional\n    An optional dictionary of custom Scrapy settings that modify the spider's behavior. Refer to Scrapy's documentation for allowed settings (https://docs.scrapy.org/en/latest/topics/settings.html).\n\nRaises\n------\nValueError\n    If the `output_file` does not end with '.jl', indicating an incorrect file format.\n\nThe function utilizes the `header_spider_path` to specify the path for the associated Scrapy spider, which processes the crawling logic. Additionally, it makes use of `MAX_CMD_LENGTH` from `advertools.spider` to manage a potential command length limit when passing long URL lists to Scrapy's command-line interface.\"\"\"\n    'Crawl a list of URLs using the HEAD method.\\n\\n    This function helps in analyzing a set of URLs by getting status codes,\\n    download latency, all response headers and a few other meta data about the\\n    crawled URLs.\\n\\n    Sine the full page is not downloaded, these requests are very light on\\n    servers and it is super-fast. You can modify the speed of course through\\n    various settings.\\n\\n    Typically status code checking is an on-going task that needs to be done\\n    and managed. Automated alerts can be easily created based on certain status\\n    codes. Another interesting piece of the information is the `Content-Length`\\n    response header. This gives you the size of the response body without\\n    having to download the whole page. It can also be very interesting with\\n    image URLs. Downloading all images can really be expensive and time\\n    consuming. Being able to get image sizes without having to download them\\n    can help a lot in making decisions about optimizing those images.\\n    Several other data can be interesting to analyze, depending on what\\n    response headers you get.\\n\\n    Parameters\\n    ----------\\n    url_list : str, list\\n      One or more URLs to crawl.\\n    output_file : str\\n      The path to the output of the crawl. Jsonlines only is supported to allow for\\n      dynamic values. Make sure your file ends with \".jl\", e.g. `output_file.jl`.\\n    custom_settings : dict\\n      A dictionary of optional custom settings that you might want to add to the\\n      spider\\'s functionality. There are over 170 settings for all kinds of options. For\\n      details please refer to the `spider settings <https://docs.scrapy.org/en/latest/topics/settings.html>`_\\n      documentation.\\n\\n    Examples\\n    --------\\n\\n    >>> import advertools as adv\\n    >>> url_list = [\\'https://exmaple.com/A\\', \\'https://exmaple.com/B\\',\\n    ...             \\'https://exmaple.com/C\\', \\'https://exmaple.com/D\\',\\n    ...             \\'https://exmaple.com/E\\']\\n\\n    >>> adv.crawl_headers(url_list, \\'output_file.jl\\')\\n    >>> import pandas as pd\\n    >>> crawl_df = pd.read_json(\\'output_file.jl\\', lines=True)\\n    '\n    if isinstance(url_list, str):\n        url_list = [url_list]\n    if output_file.rsplit('.')[-1] != 'jl':\n        raise ValueError(f\"Please make sure your output_file ends with '.jl'.\\nFor example:\\n{output_file.rsplit('.', maxsplit=1)[0]}.jl\")\n    settings_list = []\n    if custom_settings is not None:\n        for key, val in custom_settings.items():\n            if isinstance(val, dict):\n                setting = '='.join([key, json.dumps(val)])\n            else:\n                setting = '='.join([key, str(val)])\n            settings_list.extend(['-s', setting])\n    command = ['scrapy', 'runspider', header_spider_path, '-a', 'url_list=' + ','.join(url_list), '-o', output_file] + settings_list\n    if len(','.join(url_list)) > MAX_CMD_LENGTH:\n        split_urls = _split_long_urllist(url_list)\n        for u_list in split_urls:\n            command[4] = 'url_list=' + ','.join(u_list)\n            subprocess.run(command)\n    else:\n        subprocess.run(command)",
        "docstring": "Crawl a list of URLs using the HEAD method to gather HTTP response headers and status codes efficiently.\n\nThis function performs lightweight HTTP HEAD requests to each URL provided in `url_list`, retrieving various metadata and reponse details without downloading full page content. It saves the results into a specified output file in JSON Lines format, which allows for easy dynamic data handling.\n\nParameters\n----------\nurl_list : str, list\n    One or more URLs to crawl, which can be provided as a single string or a list of strings.\noutput_file : str\n    The path to the file where the crawl results will be saved. This must end with '.jl' to follow the JSON Lines format.\ncustom_settings : dict, optional\n    An optional dictionary of custom Scrapy settings that modify the spider's behavior. Refer to Scrapy's documentation for allowed settings (https://docs.scrapy.org/en/latest/topics/settings.html).\n\nRaises\n------\nValueError\n    If the `output_file` does not end with '.jl', indicating an incorrect file format.\n\nThe function utilizes the `header_spider_path` to specify the path for the associated Scrapy spider, which processes the crawling logic. Additionally, it makes use of `MAX_CMD_LENGTH` from `advertools.spider` to manage a potential command length limit when passing long URL lists to Scrapy's command-line interface.",
        "signature": "def crawl_headers(url_list, output_file, custom_settings=None):",
        "type": "Function",
        "class_signature": null
      }
    }
  },
  "dependency_dict": {},
  "PRD": "# PROJECT NAME: advertools-test_header_spider\n\n# FOLDER STRUCTURE:\n```\n..\n\u2514\u2500\u2500 advertools/\n    \u2514\u2500\u2500 header_spider.py\n        \u2514\u2500\u2500 crawl_headers\n```\n\n# IMPLEMENTATION REQUIREMENTS:\n## MODULE DESCRIPTION:\nThis module is designed to facilitate the structured extraction and validation of HTTP headers from specified URLs. It provides functionality for crawling and retrieving header information in a tabular format, enabling users to analyze critical metadata such as URL status, crawl timestamps, and associated response details. By enforcing constraints such as valid file extensions and ensuring compatibility with key data attributes, the module addresses the need for streamlined and reliable HTTP header analysis, reducing errors and enhancing usability in data processing workflows. It is particularly useful for developers and analysts performing large-scale web scraping, diagnostics, or SEO-related audits.\n\n## FILE 1: advertools/header_spider.py\n\n- FUNCTION NAME: crawl_headers\n  - SIGNATURE: def crawl_headers(url_list, output_file, custom_settings=None):\n  - DOCSTRING: \n```python\n\"\"\"\nCrawl a list of URLs using the HEAD method to gather HTTP response headers and status codes efficiently.\n\nThis function performs lightweight HTTP HEAD requests to each URL provided in `url_list`, retrieving various metadata and reponse details without downloading full page content. It saves the results into a specified output file in JSON Lines format, which allows for easy dynamic data handling.\n\nParameters\n----------\nurl_list : str, list\n    One or more URLs to crawl, which can be provided as a single string or a list of strings.\noutput_file : str\n    The path to the file where the crawl results will be saved. This must end with '.jl' to follow the JSON Lines format.\ncustom_settings : dict, optional\n    An optional dictionary of custom Scrapy settings that modify the spider's behavior. Refer to Scrapy's documentation for allowed settings (https://docs.scrapy.org/en/latest/topics/settings.html).\n\nRaises\n------\nValueError\n    If the `output_file` does not end with '.jl', indicating an incorrect file format.\n\nThe function utilizes the `header_spider_path` to specify the path for the associated Scrapy spider, which processes the crawling logic. Additionally, it makes use of `MAX_CMD_LENGTH` from `advertools.spider` to manage a potential command length limit when passing long URL lists to Scrapy's command-line interface.\n\"\"\"\n```\n\n# TASK DESCRIPTION:\nIn this project, you need to implement the functions and methods listed above. The functions have been removed from the code but their docstrings remain.\nYour task is to:\n1. Read and understand the docstrings of each function/method\n2. Understand the dependencies and how they interact with the target functions\n3. Implement the functions/methods according to their docstrings and signatures\n4. Ensure your implementations work correctly with the rest of the codebase\n",
  "file_code": {
    "advertools/header_spider.py": "\"\"\"\n.. _crawl_headers:\n\n\ud83d\udd77 Python Status Code Checker with Response Headers\n===================================================\n\nA mini crawler that only makes ``HEAD`` requests to a known list of URLs. It\nuses `Scrapy <https://docs.scrapy.org/en/latest>`_ under the hood, which means\nyou get all its power in a simplified interface for a simple and specific\nuse-case.\n\nThe :func:`crawl_headers` function can be used to make those requests for\nvarious quality assurance and analysis reasons. Since ``HEAD`` requests don't\ndownload the whole page, this makes the crawling super light on servers, and\nmakes the process very fast.\n\nThe function is straight-forward and easy to use, you basically need a list of\nURLs and a file path where you want to save the output (in `.jl` format):\n\n.. thebe-button::\n    Run this code\n\n\n.. code-block::\n    :class: thebe, thebe-init\n\n    import advertools as adv\n    import pandas as pd\n\n    url_list = ['https://advertools.readthedocs.io', 'https://adver.tools',\n                'https://www.dashboardom.com', 'https://povertydata.org']\n    adv.crawl_headers(url_list, 'output_file.jl')\n    headers_df = pd.read_json('output_file.jl', lines=True)\n\n    headers_df\n\n\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n  ..  url                                           crawl_time             status    download_timeout  download_slot                download_latency    depth  protocol      body    resp_headers_content-length  resp_headers_server    resp_headers_date              resp_headers_content-type    resp_headers_content-encoding    request_headers_accept                                           request_headers_accept-language    request_headers_user-agent    request_headers_accept-encoding    resp_headers_vary      redirect_times    redirect_ttl  redirect_urls                        redirect_reasons  resp_headers_x-amz-id-2                                                       resp_headers_x-amz-request-id    resp_headers_last-modified     resp_headers_etag                     resp_headers_x-served    resp_headers_x-backend    resp_headers_x-rtd-project    resp_headers_x-rtd-version    resp_headers_x-rtd-path                     resp_headers_x-rtd-domain    resp_headers_x-rtd-version-method    resp_headers_x-rtd-project-method    resp_headers_referrer-policy    resp_headers_permissions-policy    resp_headers_strict-transport-security        resp_headers_cf-cache-status      resp_headers_age  resp_headers_expires           resp_headers_cache-control    resp_headers_expect-ct                                                                   resp_headers_cf-ray    resp_headers_alt-svc                         resp_headers_via\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n   0  https://adver.tools                           2022-02-11 02:32:26       200                 180  adver.tools                         0.0270483        0  HTTP/1.1       nan                              0  nginx/1.18.0 (Ubuntu)  Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      nan                               nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          nan\n   1  https://povertydata.org                       2022-02-11 02:32:26       200                 180  povertydata.org                     0.06442          0  HTTP/1.1       nan                          13270  nginx/1.18.0 (Ubuntu)  Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      Accept-Encoding                   nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          nan\n   2  https://advertools.readthedocs.io/en/master/  2022-02-11 02:32:26       200                 180  advertools.readthedocs.io           0.0271282        0  HTTP/1.1       nan                              0  cloudflare             Fri, 11 Feb 2022 02:32:26 GMT  text/html                    gzip                             text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      Accept-Encoding                     1              19  https://advertools.readthedocs.io                 302  rNKT7MYjJ7hcnSvbnZg9qdqizeFfTx9YtZ3/gwNLj8M99yumuCgdd6YTm/iBMO9hrZTAi/iYl50=  EE0DJX6Z511TGX88                 Thu, 10 Feb 2022 17:04:27 GMT  W/\"14c904a172315a4922f4d28948b916c2\"  Nginx-Proxito-Sendfile   web-i-0710e93d610dd8c3e   advertools                    master                        /proxito/html/advertools/master/index.html  advertools.readthedocs.io    path                                 subdomain                            no-referrer-when-downgrade      interest-cohort=()                 max-age=31536000; includeSubDomains; preload  HIT                                           1083  Fri, 11 Feb 2022 04:32:26 GMT  public, max-age=7200          max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"  6dba2aae6b424107-PRG   h3=\":443\"; ma=86400, h3-29=\":443\"; ma=86400  nan\n   3  https://www.dashboardom.com                   2022-02-11 02:32:26       200                 180  www.dashboardom.com                 0.118614         0  HTTP/1.1       nan                          26837  gunicorn/19.9.0        Fri, 11 Feb 2022 02:32:26 GMT  text/html; charset=utf-8     nan                              text/html,application/xhtml+xml,application/xml;q=0.9,...;q=0.8  en                                 advertools/0.13.0.rc2         gzip, deflate                      nan                               nan             nan  nan                                               nan  nan                                                                           nan                              nan                            nan                                   nan                      nan                       nan                           nan                           nan                                         nan                          nan                                  nan                                  nan                             nan                                nan                                           nan                                            nan  nan                            nan                           nan                                                                                      nan                    nan                                          1.1 vegur\n====  ============================================  ===================  ========  ==================  =========================  ==================  =======  ==========  ======  =============================  =====================  =============================  ===========================  ===============================  ===============================================================  =================================  ============================  =================================  ===================  ================  ==============  =================================  ==================  ============================================================================  ===============================  =============================  ====================================  =======================  ========================  ============================  ============================  ==========================================  ===========================  ===================================  ===================================  ==============================  =================================  ============================================  ==============================  ==================  =============================  ============================  =======================================================================================  =====================  ===========================================  ==================\n\n\n\nOptionally, you can customize the crawling behavior with the optional\n``custom_settings`` parameter. Please check the\n`crawl strategies <_crawl_strategies>`_ page for tips on how you can do that.\n\nHere are some of the common reasons for using a ``HEAD`` crawler:\n\n* **Checking status codes:** One of the most important maintenance tasks you\n  should be doing continuously. It's very easy to set up an automated script\n  the checks status codes for a few hundred or thousand URLs on a periodic\n  basis. You can easily build some rules and alerts based on the status codes\n  you get.\n* **Status codes of page elements:** Yes, your page returns a 200 OK status,\n  but what about all the elements/components of the page? Images, links\n  (internal and external), hreflang, canonical, URLs in metatags, script URLs,\n  URLs in various structured data elements like Twitter, OpenGraph, and\n  JSON-LD are some of the most important ones to check as well.\n* **Getting search engine directives:** Those directives can be set using meta\n  tags as well as response headers. This crawler gets all available response\n  headers so you can check for search engine-specific ones, like `noindex` for\n  example.\n* **Getting image sizes:** You might want to crawl a list of image URLs and get\n  their meta data. The response header `Content-Length` contains the length of\n  the page in bytes. With images, it contains the size of the image. This can\n  be an extremely efficient way of analyzing image sizes (and other meta data)\n  without having to download those images, which could consume a lot of\n  bandwidth. Lookout for the column ``resp_headers_content-length``.\n* **Getting image types:** The ``resp_headers_content-type`` gives you an\n  indication on the type of content of the page (or image when crawling image\n  URLs); `text/html`, `image/jpeg` and `image/png` are some such content types.\n\n\n\"\"\"\nimport datetime\nimport json\nimport subprocess\nfrom scrapy import Request, Spider\nfrom scrapy.exceptions import IgnoreRequest\nimport advertools as adv\nfrom advertools import __version__ as adv_version\nfrom advertools.spider import MAX_CMD_LENGTH, _split_long_urllist\nheader_spider_path = adv.__path__[0] + '/header_spider.py'\nuser_agent = f'advertools/{adv_version}'\n\nclass HeadersSpider(Spider):\n    name = 'headers_spider'\n    custom_settings = {'USER_AGENT': user_agent, 'ROBOTSTXT_OBEY': True, 'HTTPERROR_ALLOW_ALL': True, 'AUTOTHROTTLE_ENABLED': True, 'AUTOTHROTTLE_TARGET_CONCURRENCY': 8}\n\n    def __init__(self, url_list=None, *args, **kwargs):\n        super().__init__(*args, **kwargs)\n        self.start_urls = json.loads(json.dumps(url_list.split(',')))\n\n    def start_requests(self):\n        for url in self.start_urls:\n            try:\n                yield Request(url, callback=self.parse, errback=self.errback, method='HEAD')\n            except Exception as e:\n                self.logger.error(repr(e))\n\n    def errback(self, failure):\n        if not failure.check(IgnoreRequest):\n            self.logger.error(repr(failure))\n            now = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')\n            yield {'url': failure.request.url, 'crawl_time': now, 'errors': repr(failure)}\n\n    def parse(self, response):\n        now = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')\n        yield {'url': response.url, 'crawl_time': now, 'status': response.status, **{k: '@@'.join((str(val) for val in v)) if isinstance(v, list) else v for k, v in response.meta.items()}, 'protocol': response.protocol, 'body': response.text or None, **{'resp_headers_' + k: v for k, v in response.headers.to_unicode_dict().items()}, **{'request_headers_' + k: v for k, v in response.request.headers.to_unicode_dict().items()}}"
  },
  "call_tree": {
    "tests/test_header_spider.py:test_crawl_headers_raises_on_wrong_file_extension": {
      "advertools/header_spider.py:crawl_headers": {}
    }
  }
}